webpackJsonp([3],{0:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}var i=n(4),o=a(i),s=n(35),l=n(156),r=a(l),u=document.getElementById("metronomeContainer");u&&(0,s.render)(o["default"].createElement(r["default"],null),u)},35:function(e,t,n){"use strict";e.exports=n(44)},156:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=n(4),u=a(r),c=30,d=200,h=0,m=100,f=25,v=.1,g=.05,p=50,y=4,b=1,k=14,x=7,E="#979797",N="#DB2828",C="#2185D0",O="#EEE",w={tempo:101,noteResolution:"4",isPlaying:!1,signature:"4/4",accentFirstBeat:!1,volume:.5,useOscillator:!0},S=function(e){function t(){i(this,t);var e=o(this,Object.getPrototypeOf(t).call(this));return e.state=w,e.audioContext=null,e.timeWorker=null,e.current16thNote=0,e.nextNoteTime=0,e.notesInQueue=[],e.quartersQuantity=null,e.sixteenthQuantity=null,e.nextNoteMultiplier=null,e.svg=null,e.svgWidth=254,e.pointer=null,e.spacing=null,e.unlocked=!1,e.decodedBeatSound=null,e.playButton=null,e.browserCompatible=!0,e.handlePlay=e.handlePlay.bind(e),e.handleChangeTempo=e.handleChangeTempo.bind(e),e.handleChangeVolume=e.handleChangeVolume.bind(e),e.handleToggleAccentFirstBeat=e.handleToggleAccentFirstBeat.bind(e),e.handleToggleUseOscillator=e.handleToggleUseOscillator.bind(e),e}return s(t,e),l(t,[{key:"init",value:function(){var e=this,t=window.AudioContext||window.webkitAudioContext||!1;return this.initSvg(),t?(this.audioContext=new t,this.loadBeatData().then(function(t){e.decodedBeatSound=t},function(e){console.log("Cannot load beat sound.",e)}),this.timerWorker=new Worker("assets/metronome/metronomeworker.js"),this.timerWorker.onmessage=function(t){"tick"===t.data&&e.scheduler()},void this.timerWorker.postMessage({interval:f})):void console.log("Sorry, but the Web Audio API is not supported by your browser. Please, consider upgrading to the latest version or downloading Google Chrome or Mozilla Firefox")}},{key:"initSvg",value:function(){var e=this.svgContainer,t=$(this.container).width();e&&($(e).width(t).height(50),$(this.container).width(),this.svg=new Snap(e),this.drawRuler(),this.drawPointer())}},{key:"drawRuler",value:function(){var e=this.svg.select("#ruler");e&&e.remove(),this.initParams(),this.spacing=(this.svgWidth-this.sixteenthQuantity*b)/this.sixteenthQuantity,e=this.svg.group(this.svg.line(y/2,p,this.svgWidth+y,p));for(var t=0;t<=this.sixteenthQuantity;t++){var n=this.spacing*t+t*b+y,a=t%this.quartersQuantity===0?k:x;e.add(this.svg.line(n,p,n,p-a))}e.attr({stroke:E,strokeWidth:b,id:"ruler"})}},{key:"drawPointer",value:function(){this.pointer=this.svg.polygon([y,p-k,y+3,p-38,y-3,p-38,y,p-k]).attr({fill:"#FFF"})}},{key:"movePointer",value:function(){var e=1/this.state.tempo*1500,t=this.spacing*this.current16thNote+this.current16thNote,n=void 0;n=this.state.accentFirstBeat&&0===this.current16thNote?N:this.current16thNote%this.quartersQuantity===0?C:O,this.pointer.animate({transform:"t"+t+",0",fill:n},e)}},{key:"initParams",value:function(){"4/4"===this.state.signature&&(this.sixteenthQuantity="12"===this.state.noteResolution?12:16),"3/4"===this.state.signature&&(this.sixteenthQuantity="12"===this.state.noteResolution?9:12),this.quartersQuantity="12"===this.state.noteResolution?3:4,this.nextNoteMultiplier="12"===this.state.noteResolution?.33:.25}},{key:"loadBeatData",value:function(){var e=this;return new Promise(function(t,n){var a=new XMLHttpRequest;a.open("get","assets/metronome/beat.mp3",!0),a.responseType="arraybuffer",a.onload=function(){var i=a.response;e.audioContext.decodeAudioData(i,function(e){t(e)},function(e){console.log("Error decoding audio data. "+e.err),n(e.err)})},a.send()})}},{key:"handlePlay",value:function(){var e=this;this.unlock(),this.setState({isPlaying:!this.state.isPlaying},function(){e.state.isPlaying?(e.initParams(),e.current16thNote=-1,e.nextNoteTime=e.audioContext.currentTime,e.timerWorker.postMessage("start")):e.timerWorker.postMessage("stop")})}},{key:"startOver",value:function(){this.state.isPlaying&&(this.timerWorker.postMessage("stop"),this.initParams(),this.current16thNote=-1,this.nextNoteTime=this.audioContext.currentTime,this.timerWorker.postMessage("start"))}},{key:"scheduler",value:function(){for(;this.nextNoteTime<this.audioContext.currentTime+v;)this.scheduleNote(this.current16thNote,this.nextNoteTime),this.nextNote()}},{key:"nextNote",value:function(){var e=60/this.state.tempo;this.nextNoteTime+=e*this.nextNoteMultiplier,this.current16thNote++,this.current16thNote===this.sixteenthQuantity&&(this.current16thNote=0)}},{key:"scheduleNote",value:function(e,t){var n=void 0;this.notesInQueue.push({note:e,time:t}),this.movePointer(),this.noteShouldBePlayed(e)&&(n=this.getAudioSource(e),n.start(t),n.stop(t+g))}},{key:"getAudioSource",value:function(e){var t=void 0,n=this.audioContext.createGain();return this.state.useOscillator?(t=this.audioContext.createOscillator(),0===e?t.frequency.value=this.state.accentFirstBeat?880:440:e%this.quartersQuantity===0?t.frequency.value=440:t.frequency.value=220):(t=this.audioContext.createBufferSource(),t.buffer=this.decodedBeatSound),t.connect(n),n.connect(this.audioContext.destination),n.gain.value=this.state.volume,t}},{key:"unlock",value:function(){if(this.iOS()&&!this.unlocked){var e=this.audioContext.createBufferSource();e.buffer=this.audioContext.createBuffer(1,1,22050),e.connect(this.audioContext.destination),e.noteOn(0),setTimeout(function(){(e.playbackState===e.PLAYING_STATE||e.playbackState===e.FINISHED_STATE)&&(this.unlocked=!0)},0)}}},{key:"iOS",value:function(){for(var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];e.length;)if(navigator.platform===e.pop())return!0;return!1}},{key:"isIE",value:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),n=e.indexOf("rv:"),a=void 0,i=void 0;return t>0?parseInt(e.substring(t+5,e.indexOf(".",t)),10):(a=e.indexOf("Trident/"),a>0?parseInt(e.substring(n+3,e.indexOf(".",n)),10):(i=e.indexOf("Edge/"),i>0?parseInt(e.substring(i+5,e.indexOf(".",i)),10):!1))}},{key:"isChrome",value:function n(){var e=window.chrome,t=window.navigator,a=t.vendor,i=t.userAgent.indexOf("OPR")>-1,o=t.userAgent.indexOf("Edge")>-1,s=t.userAgent.match("CriOS"),n=null!==e&&void 0!==e&&"Google Inc."===a&&i===!1&&o===!1;return s||n}},{key:"noteShouldBePlayed",value:function(e){return"4"===this.state.noteResolution&&e%4?!1:"12"===this.state.noteResolution&&[1,4,7,10].indexOf(e)>-1?!1:"8"===this.state.noteResolution&&e%2?!1:!0}},{key:"handleChangeTempo",value:function(e){this.setState({tempo:e.target.value},this.startOver)}},{key:"handleChangeResolution",value:function(e){this.setState({noteResolution:e},function(){this.drawRuler(),this.startOver()})}},{key:"handleChangeSignature",value:function(e){this.setState({signature:e},function(){this.drawRuler(),this.startOver()})}},{key:"handleChangeVolume",value:function(e){this.setState({volume:e.target.value/100})}},{key:"handleToggleAccentFirstBeat",value:function(){this.setState({accentFirstBeat:!this.state.accentFirstBeat},this.startOver)}},{key:"handleToggleUseOscillator",value:function(){this.setState({useOscillator:!this.state.useOscillator},this.startOver)}},{key:"popups",value:function(){$(".blue.question.icon").popup({transition:"vertical flip",inline:!0,hoverable:!0,delay:{show:300,hide:800}})}},{key:"componentDidMount",value:function(){var e=this;return this.isIE()?void this.popups():(this.init(),$(".ui.resolution.radio.checkbox").checkbox({onChange:function(){e.handleChangeResolution(this.value)}}),$(".ui.signature.radio.checkbox").checkbox({onChange:function(){e.handleChangeSignature(this.value)}}),$(".ui.oscillator.toggle.checkbox").checkbox({onChange:function(){e.handleToggleUseOscillator()}}),void $(".ui.accent.toggle.checkbox").checkbox({onChange:function(){e.handleToggleAccentFirstBeat()}}))}},{key:"render",value:function(){var e=this,t=this.state.isPlaying?"stop":"play",n=this.state.isPlaying?"red stop icon":"white play icon",a=parseInt(100*this.state.volume,10),i="https://github.com/alagodich/alagodich.github.io/blob/master/app/components/Metronome.jsx";return this.isChrome()?u["default"].createElement("div",{className:"metronome"},u["default"].createElement("div",{className:"ui centered card"},u["default"].createElement("div",{className:"content",ref:function(t){return e.container=t}},u["default"].createElement("a",{href:i,target:"_blank",className:"ui right corner blue label"},u["default"].createElement("i",{ref:function(t){return e.notSupportedContainer=t},className:"white github icon",style:{textDecoration:"none",cursor:"pointer"}})),u["default"].createElement("svg",{ref:function(t){return e.svgContainer=t}})),u["default"].createElement("div",{className:"extra content ui form"},u["default"].createElement("div",{id:"controls"},u["default"].createElement("div",{id:"tempo"},"Tempo: ",u["default"].createElement("span",null,this.state.tempo),u["default"].createElement("br",null),u["default"].createElement("input",{id:"tempo",type:"range",min:c,max:d,value:this.state.tempo,onChange:this.handleChangeTempo,className:"metronome__slider"})),u["default"].createElement("div",{id:"volume"},"Volume: ",u["default"].createElement("span",null,a,"%"),u["default"].createElement("br",null),u["default"].createElement("input",{id:"volume",type:"range",min:h,max:m,value:a,onChange:this.handleChangeVolume,className:"metronome__slider"})),u["default"].createElement("div",{style:{display:this.iOS()?"none":"block"}},u["default"].createElement("div",{className:"ui divider"}),u["default"].createElement("div",{className:"ui oscillator toggle checkbox"},u["default"].createElement("input",{type:"checkbox",tabIndex:"0",className:"hidden",name:"oscillator",defaultChecked:this.state.useOscillator}),u["default"].createElement("label",null,"Digital sound"))),u["default"].createElement("div",{className:"ui divider"}),u["default"].createElement("div",{className:"inline fields"},u["default"].createElement("div",{className:"field"},u["default"].createElement("div",{className:"ui resolution radio checkbox"},u["default"].createElement("input",{type:"radio",name:"resolution",value:"4",tabIndex:"0",className:"hidden",defaultChecked:"4"===this.state.noteResolution}),u["default"].createElement("label",null,"Quarter"))),u["default"].createElement("div",{className:"field"},u["default"].createElement("div",{className:"ui resolution radio checkbox"},u["default"].createElement("input",{type:"radio",name:"resolution",value:"8",tabIndex:"0",className:"hidden",defaultChecked:"8"===this.state.noteResolution}),u["default"].createElement("label",null,"8th"))),u["default"].createElement("div",{className:"field"},u["default"].createElement("div",{className:"ui resolution radio checkbox"},u["default"].createElement("input",{type:"radio",name:"resolution",value:"12",tabIndex:"0",className:"hidden",defaultChecked:"12"===this.state.noteResolution}),u["default"].createElement("label",null,"Shuffle")))),u["default"].createElement("div",{className:"ui divider"}),u["default"].createElement("div",{className:"inline fields"},u["default"].createElement("div",{className:"field"},u["default"].createElement("div",{className:"ui signature radio checkbox"},u["default"].createElement("input",{type:"radio",name:"signature",value:"4/4",tabIndex:"0",className:"hidden",defaultChecked:"4/4"===this.state.signature}),u["default"].createElement("label",null,"4/4"))),u["default"].createElement("div",{className:"field"},u["default"].createElement("div",{className:"ui signature radio checkbox"},u["default"].createElement("input",{type:"radio",name:"signature",value:"3/4",tabIndex:"0",className:"hidden",defaultChecked:"3/4"===this.state.signature}),u["default"].createElement("label",null,"3/4")))),u["default"].createElement("div",{style:{display:this.state.useOscillator?"block":"none"}},u["default"].createElement("div",{className:"ui divider"}),u["default"].createElement("div",{className:"ui accent toggle checkbox"},u["default"].createElement("input",{type:"checkbox",tabIndex:"0",className:"hidden",name:"accent",defaultChecked:this.state.accentFirstBeat}),u["default"].createElement("label",null,"Accent the first beat"))))),u["default"].createElement("button",{className:"ui bottom primary attached button",onClick:this.handlePlay,ref:function(t){return e.playButton=t}},u["default"].createElement("i",{className:n}),t))):u["default"].createElement("div",{className:"ui negative message"},u["default"].createElement("div",{className:"header"},"Sorry at this moment i support only Google Chrome."))}}]),t}(r.Component);t["default"]=S}});